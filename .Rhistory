returns_aapl <- dailyReturn(Ad(AAPL))
returns_msft <- dailyReturn(Ad(MSFT))
returns_tsla <- dailyReturn(Ad(TSLA))
plot(APPL$APPL.open)
plot(AAPL$AAPL.open)
plot(AAPL$AAPL.Open)
lineChart(AAPL$AAPL.Open, line.type = 'h', theme = 'white', TA = NULL)
#install.packages("PerformanceAnalytics")
library(quantmod)
library(PerformanceAnalytics)
library(ggplot2)
library(dplyr)
library(lubridate)
library(scales)
library(plotly)
symbols <- c("AAPL", "MSFT", "TSLA")
getSymbols(symbols, src = "yahoo", from = "2019-01-01", to = "2024-12-31")
plot_ly(x = index(returns_aapl),
y = coredata(returns_aapl),
type = 'scatter',
mode = 'lines',
name = "AAPL Adjusted Close") %>%
layout(title = "Apple (AAPL) Adjusted Close Price",
xaxis = list(title = "Date"),
yaxis = list(title = "Price (USD)"))
returns_combined <- merge(returns_aapl, returns_msft, returns_tsla)
colnames(returns_combined) <- c("AAPL", "MSFT", "TSLA")
returns_df <- data.frame(Date = index(returns_combined),
coredata(returns_combined))
returns_df <- returns_df %>%
mutate(HalfYear = paste0(year(Date), " H", ifelse(month(Date) <= 6, 1, 2)))
grouped_data <- returns_df %>%
group_by(HalfYear) %>%
summarise(across(c(AAPL, MSFT, TSLA),
list(Mean = ~mean(.x, na.rm = TRUE),
SD = ~sd(.x, na.rm = TRUE))))
returns_combined <- merge(returns_aapl, returns_msft, returns_tsla)
colnames(returns_combined) <- c("AAPL", "MSFT", "TSLA")
returns_df <- data.frame(Date = index(returns_combined),
coredata(returns_combined))
returns_df <- returns_df %>%
mutate(HalfYear = paste0(year(Date), " H", ifelse(month(Date) <= 6, 1, 2)))
grouped_data <- returns_df %>%
group_by(HalfYear) %>%
summarise(across(c(AAPL, MSFT, TSLA),
list(Mean = ~mean(.x, na.rm = TRUE),
SD = ~sd(.x, na.rm = TRUE))))
grouped_data$HalfYear <- factor(grouped_data$HalfYear, levels = grouped_data$HalfYear)
event_labels <- data.frame(
HalfYear = c("2020 H1", "2021 H1", "2022 H1", "2022 H2", "2023 H1"),
label = c("COVID", "Vaccine", "War", "Inflation", "AI")
)
volatility_plot <- ggplot(grouped_data, aes(x = HalfYear)) +
geom_line(aes(y = AAPL_SD, color = "AAPL"), group = 1, size = 1) +
geom_line(aes(y = MSFT_SD, color = "MSFT"), group = 2, size = 1) +
geom_line(aes(y = TSLA_SD, color = "TSLA"), group = 3, size = 1) +
geom_point(aes(y = AAPL_SD, color = "AAPL"), size = 2) +
geom_point(aes(y = MSFT_SD, color = "MSFT"), size = 2) +
geom_point(aes(y = TSLA_SD, color = "TSLA"), size = 2) +
geom_vline(
xintercept = which(grouped_data$HalfYear %in% event_labels$HalfYear),
linetype = "dashed", color = "red", size = 0.5
) +
geom_text(
data = event_labels,
aes(x = HalfYear, y = 0, label = label),
inherit.aes = FALSE,
angle = 0, vjust = 1.5, hjust = 0.5,
color = "red", size = 3.5
) +
labs(
title = "6-Month Volatility by Stock with Key Events",
subtitle = "Standard Deviation of Daily Returns for AAPL, MSFT, and TSLA",
x = "Period (Half-Year)",
y = "Volatility (Standard Deviation)",
color = "Stock"
) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1)
)
volatility_plot
grouped_data$HalfYear <- factor(grouped_data$HalfYear, levels = grouped_data$HalfYear)
event_labels <- data.frame(
HalfYear = c("2020 H1", "2021 H1", "2022 H1", "2022 H2", "2023 H1"),
label = c("COVID", "Vaccine", "War", "Inflation", "AI")
)
library(plotly)
plot_ly(data = grouped_data) %>%
add_trace(x = ~HalfYear, y = ~AAPL_SD, name = "AAPL", type = 'scatter', mode = 'lines+markers') %>%
add_trace(x = ~HalfYear, y = ~MSFT_SD, name = "MSFT", type = 'scatter', mode = 'lines+markers') %>%
add_trace(x = ~HalfYear, y = ~TSLA_SD, name = "TSLA", type = 'scatter', mode = 'lines+markers') %>%
add_annotations(
data = event_labels,
x = ~HalfYear,
y = 0,
text = ~label,
showarrow = FALSE,
yanchor = "bottom",
font = list(color = "red", size = 12)
) %>%
layout(
title = "6-Month Volatility by Stock with Key Events",
xaxis = list(title = "Period (Half-Year)", tickangle = -45),
yaxis = list(title = "Volatility (Standard Deviation)"),
legend = list(title = list(text = "Stock"))
)
grouped_data$HalfYear <- factor(grouped_data$HalfYear, levels = grouped_data$HalfYear)
event_labels <- data.frame(
HalfYear = c("2020 H1", "2021 H1", "2022 H1", "2022 H2", "2023 H1"),
label = c("COVID", "Vaccine", "War", "Inflation", "AI")
)
volatility_plot <- ggplot(grouped_data, aes(x = HalfYear)) +
geom_line(aes(y = AAPL_SD, color = "AAPL"), group = 1, size = 1) +
geom_line(aes(y = MSFT_SD, color = "MSFT"), group = 2, size = 1) +
geom_line(aes(y = TSLA_SD, color = "TSLA"), group = 3, size = 1) +
geom_point(aes(y = AAPL_SD, color = "AAPL"), size = 2) +
geom_point(aes(y = MSFT_SD, color = "MSFT"), size = 2) +
geom_point(aes(y = TSLA_SD, color = "TSLA"), size = 2) +
geom_vline(
xintercept = which(grouped_data$HalfYear %in% event_labels$HalfYear),
linetype = "dashed", color = "red", size = 0.5
) +
geom_text(
data = event_labels,
aes(x = HalfYear, y = 0, label = label),
inherit.aes = FALSE,
angle = 0, vjust = 1.5, hjust = 0.5,
color = "red", size = 3.5
) +
labs(
title = "6-Month Volatility by Stock with Key Events",
subtitle = "Standard Deviation of Daily Returns for AAPL, MSFT, and TSLA",
x = "Period (Half-Year)",
y = "Volatility (Standard Deviation)",
color = "Stock"
) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1)
)
volatility_plot
library(plotly)
plot_ly(data = grouped_data) %>%
add_trace(x = ~HalfYear, y = ~AAPL_SD, name = "AAPL", type = 'scatter', mode = 'lines+markers') %>%
add_trace(x = ~HalfYear, y = ~MSFT_SD, name = "MSFT", type = 'scatter', mode = 'lines+markers') %>%
add_trace(x = ~HalfYear, y = ~TSLA_SD, name = "TSLA", type = 'scatter', mode = 'lines+markers') %>%
add_annotations(
data = event_labels,
x = ~HalfYear,
y = 0,
text = ~label,
showarrow = FALSE,
yanchor = "bottom",
font = list(color = "red", size = 12)
) %>%
layout(
title = "6-Month Volatility by Stock with Key Events",
xaxis = list(title = "Period (Half-Year)", tickangle = -45),
yaxis = list(title = "Volatility (Standard Deviation)"),
legend = list(title = list(text = "Stock"))
)
grouped_data$HalfYear <- factor(grouped_data$HalfYear, levels = grouped_data$HalfYear)
event_labels <- data.frame(
HalfYear = c("2020 H1", "2021 H1", "2022 H1", "2022 H2", "2023 H1"),
label = c("COVID", "Vaccine", "War", "Inflation", "AI")
)
volatility_plot <- plot_ly(data = grouped_data) %>%
add_trace(x = ~HalfYear, y = ~AAPL_SD, name = "AAPL", type = 'scatter', mode = 'lines+markers') %>%
add_trace(x = ~HalfYear, y = ~MSFT_SD, name = "MSFT", type = 'scatter', mode = 'lines+markers') %>%
add_trace(x = ~HalfYear, y = ~TSLA_SD, name = "TSLA", type = 'scatter', mode = 'lines+markers') %>%
add_annotations(
data = event_labels,
x = ~HalfYear,
y = 0,
text = ~label,
showarrow = FALSE,
yanchor = "bottom",
font = list(color = "red", size = 12)
) %>%
layout(
title = "6-Month Volatility by Stock with Key Events",
xaxis = list(title = "Period (Half-Year)", tickangle = -45),
yaxis = list(title = "Volatility (Standard Deviation)"),
legend = list(title = list(text = "Stock"))
)
volatility_plot
grouped_data$HalfYear <- factor(grouped_data$HalfYear, levels = grouped_data$HalfYear)
event_lines <- lapply(event_labels$HalfYear, function(h) {
list(
type = "line",
x0 = h,
x1 = h,
y0 = 0,
y1 = 1,
xref = "x",
yref = "paper",
line = list(color = "red", dash = "dash", width = 1)
)
})
volatility_plot <- plot_ly(data = grouped_data) %>%
add_trace(x = ~HalfYear, y = ~AAPL_SD, name = "AAPL", type = 'scatter', mode = 'lines+markers') %>%
add_trace(x = ~HalfYear, y = ~MSFT_SD, name = "MSFT", type = 'scatter', mode = 'lines+markers') %>%
add_trace(x = ~HalfYear, y = ~TSLA_SD, name = "TSLA", type = 'scatter', mode = 'lines+markers') %>%
add_annotations(
data = event_labels,
x = ~HalfYear,
y = 0,
text = ~label,
showarrow = FALSE,
yanchor = "bottom",
font = list(color = "red", size = 12)
) %>%
layout(
title = "6-Month Volatility by Stock with Key Events",
xaxis = list(title = "Period (Half-Year)", tickangle = -45),
yaxis = list(title = "Volatility (Standard Deviation)"),
legend = list(title = list(text = "Stock"))
shapes = event_lines
grouped_data$HalfYear <- factor(grouped_data$HalfYear, levels = grouped_data$HalfYear)
event_lines <- lapply(event_labels$HalfYear, function(h) {
list(
type = "line",
x0 = h,
x1 = h,
y0 = 0,
y1 = 1,
xref = "x",
yref = "paper",
line = list(color = "red", dash = "dash", width = 1)
)
})
volatility_plot <- plot_ly(data = grouped_data) %>%
add_trace(x = ~HalfYear, y = ~AAPL_SD, name = "AAPL", type = 'scatter', mode = 'lines+markers') %>%
add_trace(x = ~HalfYear, y = ~MSFT_SD, name = "MSFT", type = 'scatter', mode = 'lines+markers') %>%
add_trace(x = ~HalfYear, y = ~TSLA_SD, name = "TSLA", type = 'scatter', mode = 'lines+markers') %>%
add_annotations(
data = event_labels,
x = ~HalfYear,
y = 0,
text = ~label,
showarrow = FALSE,
yanchor = "bottom",
font = list(color = "red", size = 12)
) %>%
layout(
title = "6-Month Volatility by Stock with Key Events",
xaxis = list(title = "Period (Half-Year)", tickangle = -45),
yaxis = list(title = "Volatility (Standard Deviation)"),
legend = list(title = list(text = "Stock")),
shapes = event_lines
)
volatility_plot
grouped_data$HalfYear <- factor(grouped_data$HalfYear, levels = grouped_data$HalfYear)
event_labels <- data.frame(
HalfYear = c("2020 H1", "2021 H1", "2022 H1", "2022 H2", "2023 H1"),
label = c("COVID", "Vaccine", "War", "Inflation", "AI")
)
event_lines <- lapply(event_labels$HalfYear, function(h) {
list(
type = "line",
x0 = h,
x1 = h,
y0 = 0,
y1 = 1,
xref = "x",
yref = "paper",
line = list(color = "red", dash = "dash", width = 0.5)
)
})
volatility_plot <- plot_ly(data = grouped_data) %>%
add_trace(x = ~HalfYear, y = ~AAPL_SD, name = "AAPL", type = 'scatter', mode = 'lines+markers') %>%
add_trace(x = ~HalfYear, y = ~MSFT_SD, name = "MSFT", type = 'scatter', mode = 'lines+markers') %>%
add_trace(x = ~HalfYear, y = ~TSLA_SD, name = "TSLA", type = 'scatter', mode = 'lines+markers') %>%
add_annotations(
data = event_labels,
x = ~HalfYear,
y = 0,
text = ~label,
showarrow = FALSE,
yanchor = "bottom",
font = list(color = "red", size = 12)
) %>%
layout(
title = "6-Month Volatility by Stock with Key Events",
xaxis = list(title = "Period (Half-Year)", tickangle = -45),
yaxis = list(title = "Volatility (Standard Deviation)"),
legend = list(title = list(text = "Stock")),
shapes = event_lines
)
volatility_plot
grouped_data$HalfYear <- factor(grouped_data$HalfYear, levels = grouped_data$HalfYear)
event_labels <- data.frame(
HalfYear = c("2020 H1", "2021 H1", "2022 H1", "2022 H2", "2023 H1"),
label = c("COVID", "Vaccine", "War", "Inflation", "AI")
)
event_lines <- lapply(event_labels$HalfYear, function(h) {
list(
type = "line",
x0 = h,
x1 = h,
y0 = 0,
y1 = 1,
xref = "x",
yref = "paper",
line = list(color = "red", dash = "dash", width = 0.5)
)
})
volatility_plot <- plot_ly(data = grouped_data) %>%
add_trace(x = ~HalfYear, y = ~AAPL_SD, name = "AAPL", type = 'scatter', mode = 'lines+markers') %>%
add_trace(x = ~HalfYear, y = ~MSFT_SD, name = "MSFT", type = 'scatter', mode = 'lines+markers') %>%
add_trace(x = ~HalfYear, y = ~TSLA_SD, name = "TSLA", type = 'scatter', mode = 'lines+markers') %>%
add_annotations(
data = event_labels,
x = ~HalfYear,
y = 0,
text = ~label,
showarrow = FALSE,
yanchor = "bottom",
font = list(color = "red", size = 10)
) %>%
layout(
title = "6-Month Volatility by Stock with Key Events",
xaxis = list(title = "Period (Half-Year)", tickangle = -45),
yaxis = list(title = "Volatility (Standard Deviation)"),
legend = list(title = list(text = "Stock")),
shapes = event_lines
)
volatility_plot
grouped_data$HalfYear <- factor(grouped_data$HalfYear, levels = grouped_data$HalfYear)
event_labels <- data.frame(
HalfYear = c("2020 H1", "2021 H1", "2022 H1", "2023 H1"),
label = c("COVID", "Vaccine", "War", "AI")
)
event_lines <- lapply(event_labels$HalfYear, function(h) {
list(
type = "line",
x0 = h,
x1 = h,
y0 = 0,
y1 = 1,
xref = "x",
yref = "paper",
line = list(color = "red", dash = "dash", width = 0.5)
)
})
volatility_plot <- plot_ly(data = grouped_data) %>%
add_trace(x = ~HalfYear, y = ~AAPL_SD, name = "AAPL", type = 'scatter', mode = 'lines+markers') %>%
add_trace(x = ~HalfYear, y = ~MSFT_SD, name = "MSFT", type = 'scatter', mode = 'lines+markers') %>%
add_trace(x = ~HalfYear, y = ~TSLA_SD, name = "TSLA", type = 'scatter', mode = 'lines+markers') %>%
add_annotations(
data = event_labels,
x = ~HalfYear,
y = 0,
text = ~label,
showarrow = FALSE,
yanchor = "bottom",
font = list(color = "red", size = 10)
) %>%
layout(
title = "6-Month Volatility by Stock with Key Events",
xaxis = list(title = "Period (Half-Year)", tickangle = -45),
yaxis = list(title = "Volatility (Standard Deviation)"),
legend = list(title = list(text = "Stock")),
shapes = event_lines
)
volatility_plot
grouped_data$HalfYear <- factor(grouped_data$HalfYear, levels = grouped_data$HalfYear)
event_labels <- data.frame(
HalfYear = c("2020 H1", "2021 H1", "2022 H1", "2023 H1"),
label = c("COVID", "Vaccine", "War", "AI")
)
event_lines <- lapply(event_labels$HalfYear, function(h) {
list(
type = "line",
x0 = h,
x1 = h,
y0 = 0,
y1 = 1,
xref = "x",
yref = "paper",
line = list(color = "red", dash = "dash", width = 0.5)
)
})
volatility_plot <- plot_ly(data = grouped_data) %>%
add_trace(x = ~HalfYear, y = ~AAPL_SD, name = "AAPL", type = 'scatter', mode = 'lines+markers') %>%
add_trace(x = ~HalfYear, y = ~MSFT_SD, name = "MSFT", type = 'scatter', mode = 'lines+markers') %>%
add_trace(x = ~HalfYear, y = ~TSLA_SD, name = "TSLA", type = 'scatter', mode = 'lines+markers') %>%
add_annotations(
data = event_labels,
x = ~HalfYear,
y = 0,
text = ~label,
showarrow = FALSE,
yanchor = "bottom",
font = list(color = "red", size = 10)
) %>%
layout(
title = "6-Month Volatility by Stock with Key Events",
xaxis = list(title = "Period (Half-Year)", tickangle = -45),
yaxis = list(title = "Volatility (Standard Deviation)"),
legend = list(title = list(text = "Stock")),
shapes = event_lines
)
volatility_plot
mdd_aapl <- maxDrawdown(returns_aapl)
mdd_msft <- maxDrawdown(returns_msft)
mdd_tsla <- maxDrawdown(returns_tsla)
cat("Maximum Drawdown of AAPL:", mdd_aapl, "\n")
cat("Maximum Drawdown of MSFT:", mdd_msft, "\n")
cat("Maximum Drawdown of TSLA:", mdd_tsla, "\n")
returns_aapl <- dailyReturn(Ad(AAPL))
returns_msft <- dailyReturn(Ad(MSFT))
returns_tsla <- dailyReturn(Ad(TSLA))
aapl_prices <- Ad(AAPL)
mdd_aapl <- maxDrawdown(apple_prices)
mdd_aapl <- maxDrawdown(aapl_prices)
mdd_msft <- maxDrawdown(returns_msft)
mdd_tsla <- maxDrawdown(returns_tsla)
cat("Maximum Drawdown of AAPL:", mdd_aapl, "\n")
cat("Maximum Drawdown of MSFT:", mdd_msft, "\n")
cat("Maximum Drawdown of TSLA:", mdd_tsla, "\n")
mdd_aapl <- maxDrawdown(returns_aapl)
mdd_msft <- maxDrawdown(returns_msft)
mdd_tsla <- maxDrawdown(returns_tsla)
cat("Maximum Drawdown of AAPL:", mdd_aapl, "\n")
cat("Maximum Drawdown of MSFT:", mdd_msft, "\n")
cat("Maximum Drawdown of TSLA:", mdd_tsla, "\n")
returns_aapl <- dailyReturn(Ad(AAPL))
returns_msft <- dailyReturn(Ad(MSFT))
returns_tsla <- dailyReturn(Ad(TSLA))
aapl_prices <- na.omit(Ad(AAPL))
mdd_aapl <- maxDrawdown(aapl_prices)
mdd_msft <- maxDrawdown(returns_msft)
mdd_tsla <- maxDrawdown(returns_tsla)
cat("Maximum Drawdown of AAPL:", mdd_aapl, "\n")
cat("Maximum Drawdown of MSFT:", mdd_msft, "\n")
cat("Maximum Drawdown of TSLA:", mdd_tsla, "\n")
grouped_data$HalfYear <- factor(grouped_data$HalfYear, levels = grouped_data$HalfYear)
return_plot <- plot_ly(data = grouped_data) %>%
add_trace(x = ~HalfYear, y = ~AAPL_Mean, name = "AAPL",
type = 'scatter', mode = 'lines+markers', line = list(color = 'blue')) %>%
add_trace(x = ~HalfYear, y = ~MSFT_Mean, name = "MSFT",
type = 'scatter', mode = 'lines+markers', line = list(color = 'orange')) %>%
add_trace(x = ~HalfYear, y = ~TSLA_Mean, name = "TSLA",
type = 'scatter', mode = 'lines+markers', line = list(color = 'green')) %>%
# Olay etiketleri (COVID, Vaccine, War...)
add_annotations(
data = event_labels,
x = ~HalfYear,
y = 0,
text = ~label,
showarrow = FALSE,
yanchor = "bottom",
font = list(color = "red", size = 12)
) %>%
layout(
title = "6-Month Average Returns by Stock with Key Events",
xaxis = list(title = "Period (Half-Year)", tickangle = -45),
yaxis = list(title = "Average Daily Return", tickformat = ".1%"),
legend = list(title = list(text = "Stock")),
shapes = event_lines,
hovermode = "x unified"
)
return_plot
return_plot <- plot_ly(data = grouped_data) %>%
add_trace(x = ~HalfYear, y = ~AAPL_Mean, name = "AAPL",
type = 'scatter', mode = 'lines+markers', line = list(color = 'blue')) %>%
add_trace(x = ~HalfYear, y = ~MSFT_Mean, name = "MSFT",
type = 'scatter', mode = 'lines+markers', line = list(color = 'orange')) %>%
add_trace(x = ~HalfYear, y = ~TSLA_Mean, name = "TSLA",
type = 'scatter', mode = 'lines+markers', line = list(color = 'green')) %>%
add_annotations(
data = event_labels,
x = ~HalfYear,
y = 0,
text = ~label,
showarrow = FALSE,
yanchor = "bottom",
font = list(color = "red", size = 12)
) %>%
layout(
title = "6-Month Average Returns by Stock with Key Events",
xaxis = list(title = "Period (Half-Year)", tickangle = -45),
yaxis = list(title = "Average Daily Return", tickformat = ".1%"),
legend = list(title = list(text = "Stock")),
shapes = event_lines,
hovermode = "x unified"
)
return_plot
return_plot
volatility_plot
subplot(
return_plot,
volatility_plot,
nrows = 1,
shareX = TRUE,   # X ekseni aynıysa paylaş
titleX = TRUE,   # X ekseni başlıkları göster
shareY = FALSE   # Y ekseni farklı çünkü biri return, biri volatility
) %>%
layout(
title = "6-Month Average Returns and Volatility by Stock",
legend = list(orientation = "h", x = 0.3, y = -0.15)
)
plot_ly() %>%
add_lines(data = grouped_data, x = ~HalfYear, y = ~AAPL_Mean, name = "AAPL Return", yaxis = "y1") %>%
add_lines(data = grouped_data, x = ~HalfYear, y = ~AAPL_SD, name = "AAPL Volatility", yaxis = "y2") %>%
layout(
title = "AAPL: Return vs. Volatility",
yaxis = list(title = "Average Return", tickformat = ".1%"),
yaxis2 = list(overlaying = "y", side = "right", title = "Volatility (SD)"),
xaxis = list(title = "Half-Year"),
legend = list(orientation = "h")
)
